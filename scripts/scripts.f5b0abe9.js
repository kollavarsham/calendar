"use strict";angular.module("calendarApp",["ngAnimate","ngCookies","ngResource","ui.router","ngSanitize","ngTouch","xeditable","cgBusy"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(a,e,n){a.hashPrefix("!"),n.otherwise("/"),e.state("year",{url:"/{year:int}?lang&sel",params:{year:(new Date).getFullYear()},templateUrl:"views/year.html"}).state("month",{url:"/{year:int}/{month:int}?lang&sel",templateUrl:"views/month.html"})}]).run(["$anchorScroll","editableOptions",function(a,e){a.yOffset=60,e.theme="bs3"}]),$(function(){$.scrollUp({scrollDistance:140,scrollText:"",scrollTitle:"Back to the top"})}),angular.module("calendarApp").directive("languageSwitcher",function(){return{templateUrl:"views/language-switcher.html",restrict:"A",link:function(a,e){a.$watch("lang",function(a){e.find("li").removeClass("active"),e.find("li."+a).addClass("active")})}}}),angular.module("calendarApp").directive("version",function(){return{template:'<small><a title="{{title}}" ng-href="{{href}}" target="_blank">{{versionText}}</a></small>',restrict:"E",replace:!0,link:function(e){e.$watch("version",function(a){e.title="Built at: "+a.date,e.href="https://github.com/kollavarsham/calendar/tree/"+a.object,e.versionText=a.text},!0)}}}),angular.module("calendarApp").directive("yearPicker",function(){return{templateUrl:"views/year-picker.html",restrict:"E"}}),angular.module("calendarApp").directive("monthPicker",function(){return{templateUrl:"views/month-picker.html",restrict:"E"}}),angular.module("calendarApp").directive("monthNavbar",["$location","$anchorScroll",function(n,t){return{templateUrl:"views/month-navbar.html",restrict:"E",scope:{months:"=months"},link:function(a){a.scrollTo=function(a){a="month-"+a;var e=n.hash();n.hash(a),t(),n.hash(e)}}}}]),angular.module("calendarApp").directive("onFinishRenderNgRepeat",["$timeout",function(e){return{restrict:"A",link:function(a){!0===a.$last&&e(function(){a.$parent.$emit("ngRepeatFinished")})}}}]),angular.module("calendarApp").directive("calendarMonth",["$timeout","utils",function(t,l){return{restrict:"E",replace:!0,templateUrl:"views/calendar-month.html",scope:{month:"=month",lang:"=lang",sel:"=sel"},link:function(a,e){var n=a.month;a.year=a.month.days[0].year,a.weekdaysLookup=l.weekdaysLookup,a.malayalamMonthNames=l.getMalayalamMonthNames(n),a.malayalamYears=l.getMalayalamYears(n),a.weeks=l.calculateWeeks(a),t(function(){e.find(".selected").length&&a.$parent.$emit("selectedMonthRendered",l.getMonthNamePrefix(e)),e.find(".today").length&&a.$parent.$emit("currentMonthRendered",l.getMonthNamePrefix(e))})}}}]),angular.module("calendarApp").directive("calendarDay",["utils",function(n){return{restrict:"E",templateUrl:"views/calendar-day.html",scope:{day:"=day",lang:"=lang"},link:function(a){var e=a.day;e.date&&(e.fullDate=e.date+" "+e.month+" "+e.year,e.moon=0===e.tithi?"üåï":15===e.tithi?"üåë":void 0,e.tithiDay=e.moon||n.tithisLookup[e.tithi][a.lang||"ml"])}}}]),angular.module("calendarApp").directive("scrollToTop",function(){return{template:'<a class="scroll-up" title="Back to the top">Top</a>',replace:!0,restrict:"E",link:function(a,e){e.on("click",function(){angular.element("#scrollUp").click()})}}}),angular.module("calendarApp").constant("serviceConfigConstant",{baseUrl:"https://calendar.kollavarsham.org/api/",config:{query:{method:"GET",isArray:!1,headers:{Accept:"application/json"}}}}),angular.module("calendarApp").service("utils",["$filter",function(n){this.weekdaysLookup={0:{en:"Sunday",ml:"‡¥û‡¥æ‡¥Ø‡µº"},1:{en:"Monday",ml:"‡¥§‡¥ø‡¥ô‡µç‡¥ï‡µæ"},2:{en:"Tuesday",ml:"‡¥ö‡µä‡¥µ‡µç‡¥µ"},3:{en:"Wednesday",ml:"‡¥¨‡µÅ‡¥ß‡µª"},4:{en:"Thursday",ml:"‡¥µ‡µç‡¥Ø‡¥æ‡¥¥‡¥Ç"},5:{en:"Friday",ml:"‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥ø"},6:{en:"Saturday",ml:"‡¥∂‡¥®‡¥ø"}},this.monthsLookup={1:{en:"January",ml:"‡¥ú‡¥®‡µÅ‡¥µ‡¥∞‡¥ø"},2:{en:"February",ml:"‡¥´‡µÜ‡¥¨‡µç‡¥∞‡µÅ‡¥µ‡¥∞‡¥ø"},3:{en:"March",ml:"‡¥Æ‡¥æ‡µº‡¥ö‡µç‡¥ö‡µç‚Äå"},4:{en:"April",ml:"‡¥è‡¥™‡µç‡¥∞‡¥ø‡µΩ "},5:{en:"May",ml:"‡¥Æ‡µÜ‡¥Ø‡µç‚Äå"},6:{en:"June",ml:"‡¥ú‡µÇ‡¥£‡µç‚Äç"},7:{en:"July",ml:"‡¥ú‡µÇ‡¥≤‡µà"},8:{en:"August",ml:"‡¥ì‡¥ó‡¥∏‡µç‡¥±‡µç‡¥±‡µç‚Äå"},9:{en:"September",ml:"‡¥∏‡µÜ‡¥™‡µç‡¥±‡µç‡¥±‡¥Ç‡¥¨‡µº"},10:{en:"October",ml:"‡¥í‡¥ï‡µç‡¥ü‡µã‡¥¨‡µº"},11:{en:"November",ml:"‡¥®‡¥µ‡¥Ç‡¥¨‡µº"},12:{en:"December",ml:"‡¥°‡¥ø‡¥∏‡¥Ç‡¥¨‡µº"}},this.tithisLookup={0:{en:"",ml:""},1:{en:"Prathama",ml:"‡¥™‡µç‡¥∞‡¥•‡¥Æ"},2:{en:"Dwithiya",ml:"‡¥¶‡µç‡¥µ‡¥ø‡¥§‡µÄ‡¥Ø"},3:{en:"Thrithiya",ml:"‡¥§‡µÉ‡¥§‡¥ø‡¥Ø"},4:{en:"Chathurthi",ml:"‡¥ö‡¥§‡µÅ‡µº‡¥§‡µç‡¥•‡¥ø"},5:{en:"Panchami",ml:"‡¥™‡¥û‡µç‡¥ö‡¥Æ‡¥ø"},6:{en:"Shashti",ml:"‡¥∑‡¥∑‡µç‡¥†‡¥ø"},7:{en:"Sapthami",ml:"‡¥∏‡¥™‡µç‡¥§‡¥Æ‡¥ø"},8:{en:"Ashtami",ml:"‡¥Ö‡¥∑‡µç‡¥ü‡¥Æ‡¥ø"},9:{en:"Navami",ml:"‡¥®‡¥µ‡¥Æ‡¥ø"},10:{en:"Dasami",ml:"‡¥¶‡¥∂‡¥Æ‡¥ø"},11:{en:"Ekadasi",ml:"‡¥è‡¥ï‡¥æ‡¥¶‡¥∂‡¥ø"},12:{en:"Dwadasi",ml:"‡¥¶‡µç‡¥µ‡¥æ‡¥¶‡¥∂‡¥ø"},13:{en:"Thrayodasi",ml:"‡¥§‡µç‡¥∞‡¥Ø‡µã‡¥¶‡¥∂‡¥ø"},14:{en:"Chathurdasi",ml:"‡¥ö‡¥§‡µÅ‡µº‡¥¶‡¥∂‡¥ø"},15:{en:"",ml:""}},this.unique=function(n){return n.filter(function(a,e){return n.indexOf(a)===e})},this.getMonths=function(){for(var a=[],e=0,n=Object.keys(this.monthsLookup),t=n.length;e<t;e++)a.push({value:parseInt(n[e],10),text:this.monthsLookup[n[e]].en});return a},this.getYears=function(){for(var a=[],e=1900;e<2051;e++)a.push({value:e,text:e});return a},this.getMalayalamMonthNames=function(a){var e=a.days.map(function(a){return a.malayalamMonth});return this.unique(e).join(" - ")},this.getMalayalamYears=function(a){var e=a.days.map(function(a){return a.malayalamYear});return this.unique(e).join(" - ")},this.showMonth=function(e){return function(){var a=n("filter")(e.calendar.months,{value:e.calendar.month});return e.calendar.month&&a.length?a[0].text:"Not set"}},this.showYear=function(e){return function(){var a=n("filter")(e.calendar.years,{value:e.calendar.year});return e.calendar.year&&a.length?a[0].text:"Not set"}},this.getMonthNamePrefix=function(a){return a.find(".month-name").text().substr(0,3)},this.calculateWeeks=function(a){for(var e=a.month,n=[],t=0;t<e.days.length;t++){var l=e.days[t];if(0!==n.length&&7!==n[n.length-1].length||n.push([]),1===l.date){for(var r=Object.keys(a.weekdaysLookup),o=0,i=0;i<r.length;i++){var s=r[i];if(l.weekdayName===a.weekdaysLookup[s][a.lang||"ml"]){o=s;break}}for(var c=0;c<o;c++)n[n.length-1].push({})}var d=new Date;if(l.isToday=l.year===d.getFullYear()&&l.month===this.monthsLookup[d.getMonth()+1].en&&l.date===d.getDate(),a.sel&&(l.isSelected=l.year===a.sel.getFullYear()&&l.month===this.monthsLookup[a.sel.getMonth()+1].en&&l.date===a.sel.getDate()),n[n.length-1].push(l),t===e.days.length-1)for(var h=0,m=7-n[n.length-1].length;h<m;h++)n[n.length-1].push({})}return n}}]),angular.module("calendarApp").factory("Version",["$resource","serviceConfigConstant",function(a,e){return a("version.json",{},e.config)}]),angular.module("calendarApp").factory("Year",["$resource","serviceConfigConstant",function(a,e){return a(e.baseUrl+"years/:year?lang=:lang",{},e.config)}]),angular.module("calendarApp").factory("Month",["$resource","serviceConfigConstant",function(a,e){return a(e.baseUrl+"years/:year/months/:month?lang=:lang",{},e.config)}]),angular.module("calendarApp").controller("LanguageCtrl",["$scope","$location",function(a,e){a.init=function(){a.lang="en"===e.search().lang?"en":"ml",a.switchToLanguage="en"===a.lang?"ml":"en"},a.switchLang=function(){e.search("lang",a.switchToLanguage),a.init()},a.init()}]),angular.module("calendarApp").controller("VersionCtrl",["$scope","Version",function(a,e){a.version=e.query()}]),angular.module("calendarApp").controller("YearCtrl",["$scope","$state","$stateParams","$filter","$window","utils","Year","$timeout",function(n,e,t,a,l,r,o,i){n.init=function(){n.$watch("calendar.year",function(a){e.go("year",{year:a})});var a=Date.parse(t.sel);n.calendar={year:t.year,lang:t.lang,sel:isNaN(a)?void 0:new Date(a),years:r.getYears(),previousYear:t.year-1,nextYear:t.year+1},n.calendar.data=o.query({year:n.calendar.year,lang:"en"===n.calendar.lang?"en":"ml"})},n.showYear=r.showYear(n),n.previous=function(){n.calendar.year=n.calendar.year-1},n.next=function(){n.calendar.year=n.calendar.year+1},l.onscroll=function(){n.calendar.backToTopVisibility=140<angular.element(document).scrollTop(),n.$digest()},n.$on("selectedMonthRendered",function(a,e){n.selectedMonthNamePrefix=e}),n.$on("currentMonthRendered",function(a,e){n.currentMonthNamePrefix=e}),n.$on("ngRepeatFinished",function(){var a=n.selectedMonthNamePrefix?n.selectedMonthNamePrefix:n.currentMonthNamePrefix,e=angular.element(".month-nav").find("a").filter(function(){return $(this).text().match(new RegExp("^"+a))});i(function(){e.click()},10),angular.element(".day-popover").popover({html:!0})}),n.init()}]),angular.module("calendarApp").controller("MonthCtrl",["$scope","$state","$stateParams","$filter","utils","Month",function(o,i,s,a,c,d){o.getPreviousMonthAndYear=function(){var a=o.calendar.month,e=o.calendar.year;return 0===--a&&(a=12,--e),{month:a,year:e}},o.getNextMonthAndYear=function(){var a=o.calendar.month,e=o.calendar.year;return 12<(a+=1)&&(e+=a=1),{month:a,year:e}},o.init=function(){o.$watchGroup(["calendar.year","calendar.month"],function(a){i.go("month",{year:a[0],month:a[1]})});var a=c.monthsLookup,e=Date.parse(s.sel);o.calendar={year:s.year,month:s.month,lang:s.lang,sel:isNaN(e)?void 0:new Date(e),months:c.getMonths(),years:c.getYears()};var n=o.getPreviousMonthAndYear(),t=s.year!==n.year?n.year+" ":"",l=o.getNextMonthAndYear(),r=s.year!==l.year?" "+l.year:"";angular.merge(o.calendar,{monthName:a[o.calendar.month].en,previousMonthName:t+a[n.month].en,previousYear:n.year,nextMonthName:a[l.month].en+r,nextYear:l.year}),o.calendar.data=d.query({year:o.calendar.year,month:o.calendar.month,lang:"en"===o.calendar.lang?"en":"ml"})},o.showMonth=c.showMonth(o),o.showYear=c.showYear(o),o.previous=function(){var a=o.getPreviousMonthAndYear();i.go("month",{year:a.year,month:a.month})},o.next=function(){var a=o.getNextMonthAndYear();i.go("month",{year:a.year,month:a.month})},o.$on("ngRepeatFinished",function(){angular.element(".day-popover").popover({html:!0})}),o.init()}]),angular.module("calendarApp").run(["$templateCache",function(a){a.put("views/calendar-day.html",'<a ng-show="day.date" tabindex="0" class="btn day-popover" title="{{day.fullDate}}" data-placement="auto" data-trigger="focus" data-content="<div class=\'day-popover-table\'><div class=\'text-center\'><span class=\'pull-left\'>{{day.malayalamYear}} </span><span> {{day.malayalamMonth}} </span><span class=\'pull-right\'> {{day.malayalamDay}}</span></div><div><span>{{day.naksatra}}</span><span class=\'pull-right\'>{{day.tithiDay}}</span></div></div>"> <div class="day"> <div class="gregorian">{{day.date}}</div> <div class="malayalam-day">{{day.malayalamDay}}</div> <div class="naksatra">&#160; {{day.naksatra}}</div> <div class="moon">{{day.moon}}</div> </div> </a> '),a.put("views/calendar-month.html",'<div> <div class="clearfix month-masthead"> <div class="pull-left"><span class="month-name">{{month.name}} | {{month.days[0].mlMonth}}</span></div> <div class="pull-right"> <div class="malayalam-year">{{malayalamYears}}</div> <div class="malayalam-month">{{malayalamMonthNames}}</div> </div> </div> <div class="month-year text-center"><h1>{{year}}</h1></div> <table class="calendar-table"> <colgroup span="7"></colgroup> <tbody> <tr class="head"> <th scope="col" ng-repeat="weekday in weekdaysLookup" ng-class="weekday.en == \'Sunday\' ? \'sunday\' : \'\' "> <div>{{weekday.en | limitTo: 1}}</div> <div class="malayalam-weekday">{{weekday[lang || \'ml\']}}</div> </th> </tr> <tr ng-repeat="week in weeks" on-finish-render-ng-repeat> <td ng-repeat="day in week" ng-class="{ \'today\' : day.isToday, \'selected\' : day.isSelected }"> <calendar-day day="day" lang="lang" ng-class="{ \'sunday\' : $first }"></calendar-day> </td> </tr> </tbody> </table> </div> '),a.put("views/language-switcher.html",'<li class="en"> <a class="language-switcher" ng-click="lang != \'en\' && switchLang()" title="Switch to English">English</a> </li> <li class="ml"> <a class="language-switcher" ng-click="lang != \'ml\' && switchLang()" title="Switch to ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</a> </li> '),a.put("views/month-navbar.html",'<div ng-show="months" class="nav-container container"> <ul class="month-nav"> <li><span class="month-nav-label">Jump to:</span></li> <li ng-repeat="month in months"> <span class="month-nav-sep" ng-show="$first"> | </span> <a ng-click="scrollTo(month.name)" title="{{month.name}}">{{month.name | limitTo: 3}}</a> <span class="month-nav-sep"> | </span> </li> </ul> </div> '),a.put("views/month-picker.html",'<a href="#" editable-select="calendar.month" data-e-ng-options="s.value as s.text for s in calendar.months" title="Click to change the month" buttons="no" class="month-select"> {{ showMonth() }} </a> '),a.put("views/month.html",'<div class="root" ng-controller="MonthCtrl"> <div id="calendar-nav" class="nav-container"> <span class="calendar-nav left"> <button ng-click="previous()" ng-disabled="calendar.previousYear < 1900"> &lt; {{calendar.previousMonthName}} </button> </span> <div> <small> <month-picker></month-picker> <year-picker></year-picker> </small> <div class="hint"> Click on the month or year to change it. </div> </div> <span class="calendar-nav right"> <button ng-click="next()" ng-disabled="calendar.nextYear > 2050"> {{calendar.nextMonthName}} &gt; </button> </span> </div> <div cg-busy="calendar.data"></div> <div class="calendar-container"> <div ng-repeat="month in calendar.data.months" id="{{ \'month-\' + month.name }}" class="calendar-month"> <div class="year-detail"> <a ui-sref="year({year: calendar.year, lang: calendar.lang, sel: calendar.sel})"> Back to {{calendar.year}} Calendar </a> </div> <calendar-month month="month" lang="calendar.lang" sel="calendar.sel"></calendar-month> </div> </div> </div> '),a.put("views/year-picker.html",'<a href="#" editable-select="calendar.year" data-e-ng-options="s.value as s.text for s in calendar.years" title="Click to change the year" buttons="no" class="year-select"> {{ showYear() }} </a> '),a.put("views/year.html",'<div class="root" ng-controller="YearCtrl"> <div id="calendar-nav" class="nav-container"> <span class="calendar-nav left"> <button ng-click="previous()" ng-disabled="calendar.previousYear < 1900"> &lt; {{calendar.previousYear}} </button> </span> <div> <small> <year-picker></year-picker> </small> <div class="hint"> Click on the year to change it. </div> </div> <span class="calendar-nav right"> <button ng-click="next()" ng-disabled="calendar.nextYear > 2050"> {{calendar.nextYear}} &gt; </button> </span> </div> <month-navbar months="calendar.data.months"></month-navbar> <div cg-busy="calendar.data"></div> <div class="calendar-container"> <div ng-repeat="month in calendar.data.months" id="{{ \'month-\' + month.name }}" class="calendar-month"> <div class="month-detail"> <a ui-sref="month({ year: calendar.year, month: $index + 1, lang: calendar.lang, sel: calendar.sel })"> View {{month.name}} {{calendar.year}} Calendar </a> </div> <span ng-show="calendar.backToTopVisibility" class="back-to-top"> <scroll-to-top></scroll-to-top> </span> <calendar-month month="month" lang="calendar.lang" sel="calendar.sel"></calendar-month> </div> </div> </div> ')}]);